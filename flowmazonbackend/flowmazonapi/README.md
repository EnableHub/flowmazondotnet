## Configuration

### Sources of Configuration Data

Generic Host in .NET Core loads configuartion key/value pairs from a number of sources by default, including environment variables. The sources and their load order are [detailed here](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-9.0).

You can also add optional sources of configuration data such as Azure App Configuration.

For actual sources of configuration data in each environment of this app, see top-level README for the solution.

### Required Configuration Keys

The following confguration settings must be provided:

1. `ConnectionStrings__FlowmazonDB`
   This is the connection string to the database that app (for which this image is built) uses.

2. `ALLOWED_CORS_ORIGINS`
   This is a semicolon-separated list of allowed CORS origins that the app would accept connections from when request is made from a browser.

   Example: `http://localhost:4000`

   **This does need to be set to a valid value,** even if the app is not supposed take requests from a browser. **Therefore in API integration tests, I set it to a dummy value ( e.g. `http://localhost`)**.

### Optional Configuration Keys

The ASP.NET Core accepts several configuration settings which are all optional.

- One optional seting is `ASPNETCORE_ENVIRONMENT` which defaults to `Development` but in a Docker image for this app, the base ASP.NET Core image for the app image sets it to `Production`.

- The other is `ASPNETCORE_URLS` which determined the address/domain name and/or port at which KEstrel listens. For example:

  - in the standard Dockerfile for an ASP.NET Core app generatd by VS Code (see [Dockerfile for flowmazonapi](../Dockerfile) that was autogenerated in this way then changed), as well as in the base Microsoft ASP.NET Core, this is set to `http://+:8080` so Kestrel listens on port 8080 but on any IP address and domain name. It is also exposed to other containers on the same Docker network via `EXPOSE 8080` directive that is also part of the autogenerated Dockerfile.

  ASIDE: Port 8080 is not used at all outside the contianer. This is because the client Next.js app, while served from a container running in the same Docker network (created by Docker Compose file for Local Continuous Testing), runs in a browser (whether created by Playwright or manually by us) on the host machine. This app then accesses the .NET Core API from the browser and so port 8080 mapped to port on the host machine using `ports` property of `flowmazonbackend` service in the Docker Compose file.
